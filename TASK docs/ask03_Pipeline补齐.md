# Ask03：Pipeline 补齐 - 端到端流水线

## 基本信息
- **对应任务**：task03
- **依赖阶段**：Phase 2（架构升级）
- **被依赖于**：Phase 4（质量提升）

## 阶段目标
实现完整的「小说→剧本」端到端自动化流水线，支持一键生成。

## 包含步骤
> 状态标记：( ) 待细化 | (x) 已确认

- (x) **C1 Story Bible 生成** — 产出：小说→结构化圣经模块
- (x) **C2 节拍表规划** — 产出：圣经→分集规划模块
- (x) **C3 剧本生成** — 产出：节拍表→完整剧本模块
- (x) **C4 审稿评分** — 产出：自动评分模块
- (x) **C5 返修循环** — 产出：自动返修模块
- (x) **C6 CLI 集成** — 产出：统一 pipeline 命令

## 已确认事项
- 全部使用 Claude API
- 流水线：bible → plan → write → judge → rewrite
- 输入支持 TXT + DOCX
- 输出纯文本 + DOCX 双格式

---

## (x) 步骤 C1：Story Bible 生成

### Q1：小说输入格式？
**选择**：A. TXT + DOCX 双格式（复用 text_io 和 docx_io）

### Q2：Story Bible 输出结构？
**选择**：A. 保持现有 JSON 结构（logline/主角/冲突/名场面）

### Q3：小说章节选择策略？
**选择**：A. 用户手动指定章节范围

---

## (x) 步骤 C2：节拍表规划

### Q1：节拍表粒度？
**选择**：A. 每集：核心冲突 + 反转 + 亮点 + 场景列表 + 钩子

### Q2：集数规划方式？
**选择**：A. 固定前10集

---

## (x) 步骤 C3：剧本生成

### Q1：生成策略？
**选择**：A. 逐集生成，每集独立调用

### Q2：上下文传递？
**选择**：A. 每集注入前一集摘要 + 节拍表

### Q3：输出格式？
**选择**：A. 纯文本 + DOCX 双输出

---

## (x) 步骤 C4：审稿评分

### Q1：评分维度？
**选择**：A. 格式合规 + 节奏 + 冲突密度 + 钩子质量

### Q2：评分输出格式？
**选择**：A. JSON（分数 + 修改建议列表）

---

## (x) 步骤 C5：返修循环

### Q1：返修策略？
**选择**：A. 评分低于阈值自动返修，最多N轮

### Q2：返修粒度？
**选择**：A. 整集重写

---

## (x) 步骤 C6：CLI 集成

### Q1：Pipeline 命令设计？
**选择**：A. 单一 `generate` 命令 + 参数控制各阶段

### Q2：中间产物保存？
**选择**：A. 自动保存所有中间 JSON 到输出目录

---

## 输出映射
完成细化 → `TASK docs/task03/`（plan.md + 6 个 phase 文件）✅ 已生成
